# 通义万相 MCP 服务器

一个基于 [Model Context Protocol (MCP)](https://modelcontextprotocol.io/) 的通义万相文生图服务，提供强大的AI图像生成和智能提示词优化功能。

## ✨ 功能特性

### 🎨 图像生成
- **多模型支持**: 支持 wanx2.1-t2i-turbo、wanx2.1-t2i-plus、wanx2.0-t2i-turbo
- **中英文提示词**: 完全支持中文和英文描述
- **灵活参数**: 自定义图像尺寸、数量、种子值等
- **负向提示词**: 精确控制不想要的元素
- **异步处理**: 支持长时间任务的状态查询

### 🧠 智能提示词系统
- **提示词优化**: 将简单描述转换为专业提示词
- **全面指南**: 涵盖风格、景别、镜头、光线等各个方面
- **丰富示例**: 提供大量实用的提示词模板
- **交互式帮助**: 通过对话获得个性化建议

## 🚀 快速开始

### 1. 安装依赖

```bash
cd tongyi-wanx-mcp
npm install
```

### 2. 获取API密钥

1. 访问 [阿里云百炼平台](https://bailian.console.aliyun.com/)
2. 创建应用并获取 API Key
3. 设置环境变量：

```bash
export DASHSCOPE_API_KEY="your-api-key-here"
```

### 3. 编译和运行

```bash
# 编译TypeScript
npm run build

# 启动服务器
npm start

# 或者开发模式
npm run dev
```

### 4. 测试功能

```bash
# 运行测试（无需API密钥）
node quick-test.js
```

## 🛠️ 可用工具

### text_to_image
生成AI图像的核心工具。

**参数：**
- `prompt` (必需): 图像描述，最长800字符
- `model`: 模型选择 (默认: wanx2.1-t2i-turbo)
- `negative_prompt`: 负向提示词，最长500字符
- `size`: 图像尺寸 (默认: 1024*1024)
- `n`: 生成数量 1-4 (默认: 1)
- `seed`: 随机种子 (可选)
- `prompt_extend`: 智能提示词扩展 (默认: true)
- `watermark`: 添加AI水印 (默认: false)
- `wait_for_completion`: 等待完成 (默认: true)

**示例：**
```json
{
  "model": "wanx2.1-t2i-turbo",
  "prompt": "一只可爱的橘猫，坐在窗台上，阳光洒在毛发上，温暖的色调，日系摄影风格",
  "size": "1024*1024",
  "n": 2,
  "prompt_extend": true
}
```

### query_task
查询图像生成任务状态。

**参数：**
- `task_id` (必需): 任务ID

### get_supported_models
获取所有支持的模型信息。

## 💡 智能提示词功能

### optimize-prompt
将简单描述优化为专业提示词。

**参数：**
- `description` (必需): 简单描述
- `style` (可选): 风格类型 (3D卡通、水彩、写实等)
- `shot_type` (可选): 景别类型 (特写、近景、中景、远景)

**示例：**
输入: "一只猫"
输出: "一只猫，3D卡通风格，特写镜头，高质量，精细细节，专业摄影，4K"

### prompt-guide
获取详细的提示词写作指南。

**参数：**
- `guide_type` (必需): 指南类型
  - `basic`: 基础提示词公式
  - `styles`: 风格参考
  - `shot_types`: 景别参考
  - `perspectives`: 视角参考
  - `lens_types`: 镜头类型
  - `lighting`: 光线参考

### style-examples
获取特定风格的示例提示词。

**参数：**
- `style_name` (必需): 风格名称

**可用风格：**
- 3D卡通、废土风、点彩画、超现实
- 水彩、粘土、写实、陶瓷
- 3D、水墨、折纸、工笔、国风水墨

## 📚 提示词写作指南

### 基础公式
```
主体 + 场景 + 风格
```

**示例：**
"25岁中国女孩，圆脸，看着镜头，优雅的民族服装，商业摄影，室外，电影级光照，半身特写，精致的淡妆，锐利的边缘。"

### 进阶公式
```
主体（主体描述）+ 场景（场景描述）+ 风格（定义风格）+ 镜头语言 + 氛围词 + 细节修饰
```

### 风格参考

#### 艺术风格
- **3D卡通**: 立体感强，色彩鲜艳
- **水彩**: 柔和渐变，梦幻效果
- **写实**: 细节丰富，逼真质感
- **国风水墨**: 传统美学，意境深远

#### 景别类型
- **特写**: 突出细节，情感表达
- **近景**: 半身人像，商业摄影
- **中景**: 全身展示，环境结合
- **远景**: 广阔视野，宏观场面

#### 光线效果
- **自然光**: 柔和真实
- **逆光**: 轮廓分明，梦幻光环
- **霓虹灯**: 现代都市，色彩绚丽
- **氛围光**: 情感渲染，意境营造

## 🔧 配置选项

### 环境变量
- `DASHSCOPE_API_KEY`: 通义万相API密钥 (必需)

### 模型对比

| 模型 | 特点 | 适用场景 |
|------|------|----------|
| wanx2.1-t2i-turbo | 速度快 | 快速原型、批量生成 |
| wanx2.1-t2i-plus | 细节丰富 | 高质量输出、商业用途 |
| wanx2.0-t2i-turbo | 性价比高 | 日常使用、成本控制 |

## 📝 使用示例

### 基础图像生成
```bash
# 通过MCP客户端调用
{
  "method": "tools/call",
  "params": {
    "name": "text_to_image",
    "arguments": {
      "prompt": "一朵盛开的樱花，粉色花瓣，春天的公园，阳光透过树叶，日系摄影风格，浅景深",
      "model": "wanx2.1-t2i-plus",
      "size": "1024*1024"
    }
  }
}
```

### 提示词优化
```bash
{
  "method": "prompts/get", 
  "params": {
    "name": "optimize-prompt",
    "arguments": {
      "description": "夕阳下的城市",
      "style": "废土风",
      "shot_type": "远景"
    }
  }
}
```

### 获取风格指南
```bash
{
  "method": "prompts/get",
  "params": {
    "name": "prompt-guide", 
    "arguments": {
      "guide_type": "styles"
    }
  }
}
```

## 🎯 最佳实践

### 提示词优化技巧
1. **具体描述**: 避免模糊词汇，使用具体的形容词
2. **结构化**: 按照 主体→场景→风格→细节 的顺序组织
3. **关键词组合**: 善用风格词、质量词、技术词
4. **负向提示**: 明确排除不想要的元素

### 参数调优建议
- **种子值**: 固定种子可以生成相似风格的图像
- **提示词扩展**: 对于简短描述建议开启
- **模型选择**: 根据质量要求和速度需求选择
- **尺寸设置**: 考虑用途选择合适比例

## 🐛 故障排除

### 常见问题

**Q: 提示"请设置 DASHSCOPE_API_KEY 环境变量"**
A: 确保已正确设置API密钥环境变量

**Q: 图像生成失败**
A: 检查提示词是否包含敏感内容，调整描述重试

**Q: 任务状态一直是 PENDING**
A: 服务可能繁忙，稍等片刻或使用 query_task 查询状态

**Q: 提示词优化效果不理想**
A: 尝试提供更具体的描述，使用不同的风格组合

### 测试模式
无API密钥时，服务器会运行在测试模式，可以测试：
- 工具列表获取
- 提示词优化功能  
- 风格指南查询
- 模型信息查看

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📞 支持

如有问题，请创建 GitHub Issue 或查看：
- [通义万相官方文档](https://help.aliyun.com/zh/dashscope/developer-reference/api-details-9)
- [MCP 协议规范](https://modelcontextprotocol.io/)

---

*通过智能提示词系统，让AI图像生成更简单、更专业！* 🎨✨
